<!DOCTYPE HTML>
<!--
  Stellar by HTML5 UP
  html5up.net | @ajlkn
  Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
  <head>
    <title>Crypto App Dashboard</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <script>
			
      let getRandomColor = () => {
        return "#000000".replace(/0/g,function(){return (~~(Math.random()*16)).toString(16);});
      }

      let getRandomHash = () => {
        return [...Array(30)].map(() => Math.random().toString(36)[3]).join('');
      }

      let loadUserData = () => {
        console.log('loadUserData..');

        fetch('user', {
          method: 'get',
          credentials: 'include',

        }).then(function(response) {
          return response.json();
        }).then(function(json) {
          console.log(json);

          let ethAddrElement = document.querySelector('#user-eth-address');
          ethAddrElement.textContent = json.ethAddress;

          let emailElement = document.querySelector('#user-email');
          emailElement.textContent = json.email;

          let nameElement = document.querySelector('#user-name');
          nameElement.textContent = json.name;

        }).catch(function(err) {
          console.log(err);
        });
      }

      let changeColor = () => {
        console.log('changeColor..')

        let body = {color: getRandomColor()}

        fetch('user-stats', {
          method: 'post',
          credentials: 'include',
          headers: {
            'Accept': 'application/json, text/plain, */*',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)

        }).then(function(response) {
          console.log(response);
          loadUserData(); // Reload data

        }).catch(function(err) {
          console.log(err);
        });
      }

      let logOut = () => {
        console.log('logOut..')

        fetch('logout', {
          method: 'get',
          credentials: 'include'
        }).then(function(response) {
          if (response.redirected) {
            return window.location.replace(response.url);
          }

          console.log(response);
        }).catch(function(err) {
          console.log(err);
        });
      }

      let addShape = () => {
        console.log('addShape..');

        let ethAddress = getRandomHash();
        let color = getRandomColor();
        let experience = 0;
        let level = 0;

        let body = {
          ethAddress: shapeEthAddress,
          color: shapeColor,
          sides: shapeSides
        }

        fetch('shapes', {
          method: 'post',
          credentials: 'include',
          headers: {
            'Accept': 'application/json, text/plain, */*',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        }).then(function(response) {
          alert('Shape added..');

        }).catch(function(err) {
          console.log(err);
        });
      }

      // Run on startup
      window.onload = () => { 
        loadUserData() 
      }

    </script>

  </head>
  <body>

    <!-- Wrapper -->
      <div id="wrapper">

        <!-- Header -->
          <header id="header">
            <h1>Member Dashboard</h1>
            <p>Buy Some Shapes to Get Started</p>
          </header>
				
        <!-- Main -->
          <div id="main">


            <!-- Content -->
              <section id="content" class="main">

                <hr/>

                <h1>User Info</h1>
                <div class="table-wrapper">
                  <table class="alt">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><b>Eth Address</b></td>
                        <td><b id="user-eth-address"></b></td>
                      </tr>
                      <tr>
                        <td><b>Email</b></td>
                        <td><b id="user-email"></b></td>
                      </tr>
                      <tr>
                        <td><b>Name</b></td>
                        <td id="user-name"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <h3>Actions</h3>


                <hr/>

                <h1>Animals REACT</h1>
                <div class="table-wrapper">
                  <table class="alt">
                    <thead>
                      <tr>
                        <th>Owner</th>
                        <th>Name</th>
                        <th>Color</th>
                      </tr>
                    </thead>

                    <tbody id="root-animals-list"></tbody>
										<div id="contract-interface"></div>

                  </table>
                </div>

                <h3>Actions</h3>

                <ul class="actions">
                  <li><input type="text" name="new-shape-name" id="new-shape-name" value="" placeholder="Shape Info Goes Here" /></li>
                  <li><a class="button special" onclick="addAnimal()">Create New Animal</a></li>
                </ul>


                <hr/>

                <ul class="actions">
                  <li><a class="button special" onclick="logOut()">Log Out</a></li>
                </ul>
                  

              </section>
          </div>

        <!-- Footer -->
          <footer id="footer">
            <p class="copyright">&copy; Crypto App. Design: <a href="https://html5up.net" target="_blank">HTML5 UP</a>.</p>
          </footer>

      </div>

    <!-- Scripts -->
      <script src="assets/js/jquery.min.js"></script>
      <script src="assets/js/jquery.scrollex.min.js"></script>
      <script src="assets/js/jquery.scrolly.min.js"></script>
      <script src="assets/js/skel.min.js"></script>
      <script src="assets/js/util.js"></script>
      <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
      <script src="assets/js/main.js"></script>

  </body>
</html>
